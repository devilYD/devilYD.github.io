---
layout:         post
title:          2022-10-6-JDBC详解
subtitle:       如何用Java操作数据库
date:           2022-10-6
auther:         YD
header-img:     img/YD-rainingnight.jpg
catalog:            true
tags:
        - JAVA
        - 数据库
        - 笔记

---

# JDBC详解

## 什么是JDBC

JDBC API是一个Java API，可以访问任何类型表列数据，特别是存储在关系数据库中的数据。JDBC代表Java数据库连接。

JDBC库中所包含的API通常与数据库使用于：
* 连接到数据库
* 创建SQL或MySQL语句
* 在数据库中执行SQL或MySQL查询
* 查看和修改数据库中的数据记录

## 开始使用JDBC

首先使用idea创建java项目，在pom文件中添加如下代码并用maven更新项目：

```
    <dependencies>

        <dependency>
            <groupId>mysql</groupId>
            <artifactId>mysql-connector-java</artifactId>
            <version>8.0.28</version>
        </dependency>

    </dependencies>
```

这段代码的意思是下载对于MySQL数据库的依赖。

然后新建java类，将依赖引入。

```java
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.SQLException;
import java.sql.Statement;
```

当然也可以直接使用

```java
import java.sql.*;
```

但是一方面对于初学者来说，知道用到了哪些类很重要，另一方面引入不需要的依赖会使项目过于臃肿。

那么接下来首先需要创建一个JVM虚拟机和MySQL数据库的连接，这样我们就需要一个驱动来实现这个功能，代码如下：

```JAVA
Class.forName("com.mysql.cj.jdbc.Driver");
```

Class.forName()方法用于初始化一个对象，在这里是初始化了一个mysql的数据库驱动对象DriverManager，那么在有了驱动以后，就可以进行连接了，那么接下来就可以创建一个数据库连接对象了。

```java
Connection conn = DriverManager.getConnection(url,username,password);
```

这句话的意思是调用DriverManager对象的getConnection方法创建了一个Connection对象，getConnection方法的参数分别为数据库地址，用户名，密码，其中用户名和密码均为用户自己指定，那么就只需要知道数据库地址的书写规范即可。

以下为常用的数据库url设定：

```
jdbc:mysql://localhost:3306/数据库名?autoReconnect=true&useUnicode=true&characterEncoding=utf8&serverTimezone=GMT%2B8&useSSL=false
```

乍一看就很复杂对不对，实际上拆解开并不复杂，首先前面的很好理解，“jdbc:mysql://localhost:3306/数据库名”就是指定数据库类型和端口地址，后续的则是指定连接的一些细节，具体如下：

* useUnicode：是否使用Unicode字符集，如果参数characterEncoding设置为gb2312或gbk，本参数值必须设置为true，如不指定则默认为false
* characterEncoding：当useUnicode设置为true时，指定字符编码。比如可设置为gb2312或gbk，如不指定则默认为false
* autoReconnect：当数据库连接异常中断时，是否自动重新连接？如不指定则默认为false
* autoReconnectForPools：是否使用针对数据库连接池的重连策略，如不指定则默认为false
* failOverReadOnly：自动重连成功后，连接是否设置为只读？如不指定则默认为true
* maxReconnects：autoReconnect设置为true时，重试连接的次数，默认为3
* initialTimeout：autoReconnect设置为true时，两次重连之间的时间间隔，单位：秒，默认为2
* connectTimeout：和数据库服务器建立socket连接时的超时，单位：毫秒。 0表示永不超时，适用于JDK 1.4及更高版本，默认为0
* socketTimeout：socket操作（读写）超时，单位：毫秒。 0表示永不超时，默认为0
* serverTimezone：时区，如果需要使用gmt+8(即国内标准时间)时区，需要写成GMT%2B8，否则会被解析为空
* useSSL：是否需要SSL验证，默认为true，但是MySQL会警告：建议不要在没有服务器身份验证的情况下建立SSL连接。在没有为服务器证书验证提供信任库的情况下建议设置为false

上述若不需修改默认值则可以省略，每两个设定值之间用 & 符号隔开即可。

创建连接后我们就可以完成对数据库的操作了，这时候我们需要调用Statement接口，如下：

```java
Statement stmt = conn.createStatement();
```

用我们之前创建的conn对象中的createStatement方法创建接口实例stmt，然后调用接口中的方法就能向数据库传输指令了。

类似如下代码：

```java
boolean count = stmt.execute(sql);
```

接下来开始研究具体细节。

## 未完待续